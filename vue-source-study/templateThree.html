<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <div id="root" class="c">
      <p>{{name.firstName}}-{{name.lastName}}</p>
    </div>
  </body>
</html>
<script>
  function compiler(template, data) {
    let childNodes = template.childNodes;
    for (let i = 0; i < childNodes.length; i++) {
      let type = childNodes[i].nodeType; // 1表示元素节点， 3表示文版节点 ， 8 表示注释节点
      if (type === 3) {
        let txt = childNodes[i].nodeValue;
        txt = txt.replace(/\{\{(.+?)\}\}/g, function (_, g) {
          path = g.trim();
          return getValueByPath(data, path);
        }); //  第三步： 挂载
        childNodes[i].nodeValue = txt;
      } else if (type === 1) {
        compiler(childNodes[i], data);
      }
    }
  }
  function getValueByPath(obj, path) {
    let res = obj;
    let prop;
    let paths = path.split(".");
    while ((prop = paths.shift())) {
      res = res[prop];
    }
    return res;
  }

  function createGetValueByPath(path) {
    let paths = path.split(".");
    return function getValueByPath(obj) {
      let res = obj;
      let prop;
      while ((prop = paths.shift)) {
        res = res[prop];
      }
      return res;
    };
  }

  function MyVue(options) {
    // 内部数据使用“_”开头，只读数据使用“$”开头
    this._el = options.el;
    this._data = options.data;
    this.$el = this._templateDom = document.querySelector(this._el);
    this._parent = this._templateDom.parentNode;
    this.render();
  }
  // 将虚拟Dom转换成真正的Dom添加到页面中
  MyVue.prototype.render = function () {
    this.compiler();
  };
  // 将模板和数据结合得到真正的DOM
  MyVue.prototype.compiler = function () {
    let realDom = this._templateDom.cloneNode(true);
    compiler(realDom, this._data);
    this.update(realDom);
  };
  // 将生成的Dom添加到页面
  MyVue.prototype.update = function (realDom) {
    this._parent.replaceChild(realDom, this._templateDom);
  };

  let app = new MyVue({
    el: "#root",
    data: {
      name: {
        firstName: "张",
        lastName: "小小",
      },
    },
  });
</script>
